---
title: "Obtenir la Légion d'honneur en 10 étapes"
subtitle : "Petit précis d'analyse statistique"
author: "Thomas Vroylandt"
date: "04/01/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
```

```{r packages}
library(tidyverse)
library(lubridate)
library(here)
library(htmltools)
library(reactable)
library(magick)
```

```{r import}
df_legion <- read_rds(here("data/df_legion_clean.rds"))
```


+ légendes des graphs à ajouter (version FiveThirtyEight ?)
+ taille du texte à ajuster

Légion, décoration française, etc...
Rappel des conditions, etc... + mettre une photo

Suscite parfois le scandale ou la polémique, récemment Cirelli, avant, Galliano, Patrick de Maistre, Maurice Papon, quelques dignitaires étrangers (Al Assad, Poutine), et même avant -> 1887

On a donc cherché à en savoir plus sur cette décoration, plus haute distinction française. On a utilisé pour cela la base Opendata de la DILA, une direction du Premier Ministre. Elle a été assemblée et traitée par Nathann Cohen (site) puis retraité pour l'analyse. De fait, certaines approximations sont faites et des erreurs peuvent subsister. Les détails sont à la fin.

Analyse sur 20 ans

## 1 - Tenez-vous prêts pour la nouvelle année et le 14 juillet

Les nominations se font par promotions, c'est-à-dire par vague. Pour les civils, deux promotions ont lieu chaque année, autour du 1er janvier et du 14 juillet, pour la fête nationale. Guettez donc ces moments !

Des promotions spéciales peuvent intervenir. C'est le cas après un évènement de grande ampleur, par exemple, celle du 11 avril 2018 après les Jeux Olympiques et Paralympiques de Pyeongchang, qui récompense les médaillés. Des actes particuliers de courage peuvent aussi vous valoir la décoration.

```{r quand, fig.width=12, fig.height=6}
# commentaire
text_quand <-
  tibble(
    label = c(
      "Les promotions civiles du 1er janvier et du 14 juillet sont les plus importantes",
      "Les promotions militaires sont réparties entre avril et juillet"
    ),
    x = as_date(c("2000-10-10", "2000-03-10")),
    y = c(9000, 7000)
  )

# fleche
fleche_quand <- tibble(
  x_arrow = c("2000-09-01", "2000-09-01", "2000-04-10"),
  xend_arrow = c("2000-01-03", "2000-07-16", "2000-06-20"),
  y_arrow = c(10000, 10000, 5000),
  yend_arrow = c(11000, 9000, 2000)
) %>%
  mutate_at(vars(x_arrow, xend_arrow), as_date)

# graph
df_legion %>%
  mutate(date_a_plat = as_date(paste0("2000-", mois, "-", jour))) %>%
  ggplot() +
  geom_histogram(aes(x = date_a_plat, fill = ind_militaire),
                 bins = 80) +
  scale_x_date(name = "",
               date_breaks = "1 month",
               date_labels = "%B") +
  scale_y_continuous(name = "Nombre de Légions d'honneur",
                     breaks = seq(0, 14000, 2000)) +
  scale_fill_manual(
    name = "",
    labels = c("1" = "Promotion militaire",
               "0" = "Promotion civile"),
    values = c("1" = "#e2b24c",
               "0" = "#b52a31")
  ) +
  geom_label(
    data = text_quand,
    aes(
      x = x,
      y = y,
      label = str_wrap(label, 20)
    ),
    label.size = NA,
    size = 5
  ) +
  geom_curve(
    data = fleche_quand,
    aes(
      x = x_arrow,
      y = y_arrow,
      xend = xend_arrow,
      yend = yend_arrow
    ),
    size = 0.5,
    curvature = 0.1,
    arrow = arrow(length = unit(0.01, "npc"), type = "open")
  ) +
  labs(caption = "Source : DILA, base OPENDATA - N. Cohen : https://www.steinertriples.fr/ \nSommes des nominations et promotions sur 20 ans \nTraitements : T. Vroylandt") +
  theme_minimal(base_line_size = 1) +
  theme(
    legend.position = "top",
    text = element_text(family = "ubuntu"),
    axis.text.x = element_text(
      size = 13,
      hjust = -0.1,
      angle = -30
    ),
    axis.title.y = element_text(size = 13),
    axis.text.y = element_text(size = 13),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.grid.major.y = element_line(color = "grey80"),
    plot.caption = element_text(hjust = 0,
                                size = 11),
    legend.text = element_text(size = 13)
  )
```

Le mieux reste encore d'être militaire puisque des promotions leur sont réservées. Elles sont annoncées vers la fin du printemps et le début de l'été. Certaines promotions ont aussi lieu autour du 1er novembre.

## 2 - Espèrez déjà être chevalier

La Légion d'honneur comporte différents grades : du moins au plus élevé : chevalier, officier, commandeur, grand officier et grand'croix. Les deux derniers sont plutôt appelées des "dignités". Ils sont attribués dans l'ordre et l'on ne peut sauter les étapes, sauf dans des cas très rares (Simone Veil par exemple, directement faite grand officier en 2009). Les barettes que vous êtes autorisées à porter se parent de plus en plus d'attributs à mesure que votre grade s'élève !

Si vous cherchez à obtenir cette décoration, visez plutôt le grade de chevalier, le plus courant. En effet, 80 % des décisions de nomination ou de promotion concernent ce grade, suivi par celui d'officier avec environ 16 %. Être promu commandeur ou élevé (terme consacré) grand officier voire grand'croix est beaucoup plus rare.

```{r grades}
# chemin des images
df_grade <- df_legion %>%
  filter(!is.na(grade)) %>%
  group_by(grade) %>%
  count() %>%
  ungroup() %>%
  mutate(
    image = fct_recode(
      grade,
      "data/utils/legion_chevalier_barette.svg" = "Chevalier",
      "data/utils/legion_officier_barette.svg" = "Officier",
      "data/utils/legion_commandeur_barette.svg" = "Commandeur",
      "data/utils/legion_grand_officier_barette.svg" = "Grand officier",
      "data/utils/legion_grand_croix_barette.svg" = "Grand'croix"
    ),
    part = n / sum(n),
    grade = fct_relevel(
      grade,
      "Chevalier",
      "Officier",
      "Commandeur",
      "Grand officier",
      "Grand'croix"
    )
  ) %>%
  arrange(grade) %>%
  select(image, grade, part)

# Tableau
reactable(
  df_grade,
  columns = list(
    grade = colDef(name = "Grade"),
    image = colDef(
      name = "Barette",
      cell = function(value) {
        image <- img(src = knitr::image_uri(here(value)),
                     height = "24px")
        tagList(div(style = list(display = "inline-block", width = "80px"), image))
      }
    ),
    part = colDef(name = "Part des décorations (en %)",
                  format = colFormat(percent = TRUE, digits = 1))
  ),
  striped = TRUE,
  borderless = TRUE,
  compact = TRUE,
  fullWidth = FALSE,
  sortable = FALSE
)

```

## 3 - Homme ou femme, peu d'importance

Le sexe n'a pas vraiment d'importance pusique depuis 2008, les promotions civiles sont paritaires - à l'exception des promotions exceptionnelles. 

Par contre, pour les militaires, `r df_legion %>% filter(ind_militaire == "1" & !is.na(sexe)) %>% group_by(sexe) %>% count() %>% ungroup() %>% mutate(part = n / sum(n) * 100) %>% filter(sexe == "M") %>% pull(part) %>% format(decimal.mark = ",", digits = 0)` % des décorations concernent des hommes. Cela peut aussi s'expliquer par la sur-représentation masculine dans l'armée, notamment aux plus hauts grades, davantage concernés par la Légion d'honneur.

## 4 - Engagez-vous ! Plutôt comme officier...

Une part significative des nominations et promotions concernent les militaires. En moyenne sur 20 ans, cela représente `r df_legion %>% group_by(ind_militaire) %>% count() %>% ungroup() %>% mutate(part = n / sum(n) *100) %>% filter(ind_militaire == "1") %>% pull(part) %>% format(decimal.mark = ",", digits = 0)` % du total.

Ces décorations concernent principalement les officiers, surtout ceux avec un grade élevé. Ainsi, si les militaires du rang et les sous-officiers représentent la majorité des troupes, ce sont les officiers supérieurs (commandant, lieutenant-colonel, colonel, capitaine de corvette, de frégate ou de vaisseau) qui concentrent les Légions d'honneur.

```{r grade_armee, fig.height=5.5, fig.width=12}
df_legion %>%
  filter(ind_militaire == "1" &
           !is.na(grade) & !is.na(grade_armee)) %>%
  mutate(
    grade = fct_rev(
      fct_relevel(
        grade,
        "Chevalier",
        "Officier",
        "Commandeur",
        "Grand officier",
        "Grand'croix"
      )
    ),
    grade_armee = fct_relevel(
      grade_armee,
      "militaires du rang",
      "sous-officiers",
      "officiers subalternes",
      "officiers supérieurs",
      "officiers généraux"
    )
  ) %>%
  arrange(grade, grade_armee) %>%
  ggplot(aes(x = grade_armee, fill = grade)) +
  geom_bar() +
  coord_flip() +
  scale_x_discrete(name = "",
                   labels = 
                     c(
                       "officiers généraux" = str_wrap("Officiers généraux (général, amiral)", 35),
                       "officiers supérieurs" = str_wrap("Officiers supérieurs (commandant, lieutenant-colonel, colonel, capitaine de corvette, de frégate ou de vaisseau)", 35),
                       "officiers subalternes" = str_wrap("Officiers subalternes (aspirant, sous-lieutenant, lieutenant, capitaine, enseigne)", 35),
                       "sous-officiers" = str_wrap("Sous-officiers (sergent, sergent-chef, adjudant, adjudant-chef, major, maître, gendarme, maréchal des logis)", 35),
                       "militaires du rang" = str_wrap("Militaires du rang (soldat, matelot, caporal)", 35)
                     )) +
  scale_y_continuous(name = "Nombre de décorations sur 20 ans", 
                     breaks = seq(0, 18000, 2000)) +
  scale_fill_manual(
    name = "",
    values = c(
      "Chevalier" = "#b52a31",
      "Officier" = "#460184",
      "Commandeur" = "#cecdcd",
      "Grand officier" = "#00a36b",
      "Grand'croix" = "#e2b24c"
    )
  ) +
  guides(fill = guide_legend(reverse = TRUE)) + 
  theme_minimal(base_line_size = 1) +
  theme(
    legend.position = "top",
    text = element_text(family = "ubuntu"),
    axis.text.x = element_text(
      size = 13,
      hjust = -0.1,
      angle = -30
    ),
    axis.title.x = element_text(size = 13),
    axis.text.y = element_text(size = 13),
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.major.x = element_line(color = "grey80"),
    plot.caption = element_text(hjust = 0,
                                size = 11),
    legend.text = element_text(size = 13)
  )
```

De plus plus votre grade dans l'armée est élevé, plus il le sera dans l'ordre de la Légion d'honneur. Ainsi les officiers généraux (généraux et amiraux) sont la seule catégorie à avoir moins de chevaliers (en proportion) que les autres grades. On peut supposer que c'est parce qu'ils ont déjà été nommé chevalier quand ils étaient moins gradés. Gardez donc en tête que les galons sur vos épaules vous aide à obtenir une barette rouge !

## 5 sinon quelques grands motifs

filtre civils

```{r}
df_legion %>%
  group_by(motif_nomination, grade) %>%
  count() %>%
  group_by(motif_nomination) %>%
  mutate(part = n / sum(n) * 100) %>%
  ungroup() %>%
  select(-n) %>%
  pivot_wider(
    names_from = grade,
    values_from = part,
    values_fill = list(part = 0)
  )
```

+ un nuage de mot ? (pour mettre en avant les mots président/secrétaire général, etc...)

## 6 - Perséverez (ou gagnez les JO pour aller plus vite) !

```{r motif_civil_stat, fig.height=7, fig.width=12}
df_motif_init <- df_legion %>%
  filter(
    grade == "Chevalier" &
      !is.na(motif_nomination) &
      ind_militaire == "0" &
      !is.na(annees_service) &
      motif_nomination != "étranger"
  )

# médiane totale
df_motif_median <- df_motif_init %>% 
  summarise(med = median(annees_service)) %>% 
  pull()

# résistant
df_motif_resistant_median <- df_motif_init %>% 
  group_by(motif_nomination) %>% 
  summarise(med = median(annees_service)) %>% 
  filter(motif_nomination == "résistant/anciens combattants") %>% 
  pull(med)

# sportif
df_motif_sportif_q1 <- df_motif_init %>% 
  group_by(motif_nomination) %>% 
  summarise(q1 = quantile(annees_service)[2]) %>% 
  filter(motif_nomination == "sportif") %>% 
  pull(q1)
```

En médiane, pour un civil, il faut `r df_motif_median` années de services publics ou d'activités professionnelles pour être nommé chevalier (le minimum est de 20 ans, sauf cas exceptionnels).

Selon les motifs de nomination, la médiane diffère. Elle est la plus élevée pour les résistants et anciens combattants (`r df_motif_resistant_median` années). Les sportifs peuvent être nommés très tôt puisqu'un quart d'entre eux le sont avec `r df_motif_sportif_q1` ans de services au plus, notamment du fait des promotions pour avoir gagné de grandes compétitions (Mondiaux, Jeux Olympiques). A quelques exceptions près, ce sont presque les seuls civils à être en partie affranchis de la barrière des 20 années de services.

```{r motif_civil, fig.height=7, fig.width=12}
df_legion %>%
  filter(
    grade == "Chevalier" &
      !is.na(motif_nomination) &
      ind_militaire == "0" &
      !is.na(annees_service) &
      motif_nomination != "étranger"
  ) %>%
  ggplot(aes(x = fct_reorder(motif_nomination, annees_service), y = annees_service)) +
  geom_boxplot(outlier.alpha = 0,
               fill = "#b52a31",
               alpha = 0.5) +
  coord_flip() +
  scale_x_discrete(
    name = "",
    labels = c(
      "résistant/anciens combattants" = str_wrap("Résistant / Ancien combattant", 30),
      "religion" = str_wrap("Clergé, monde religieux", 30),
      "élu" = str_wrap("Elu (local, national, ministre)", 30),
      "association/syndicat/organisation professionnelle/pompier" = str_wrap("Engagement associatif, syndical ou professionnel", 30),
      "universitaire/éducation/formation/recherche" = str_wrap("Enseignement et recherche", 30),
      "journaliste/écrivain/édition" = str_wrap("Journaliste, écrivain ou éditeur", 30),
      "artiste/culture/patrimoine" = str_wrap("Artiste / Culture / Patrimoine", 30),
      "milieu agricole" = str_wrap("Monde agricole", 30),
      "monde médico-social" = str_wrap("Monde médico-social", 30),
      "directeur de société" = str_wrap("Monde de l'entreprise", 30),
      "sportif" = str_wrap("Sportif", 30),
      "avocat/huissier/comptable/notaire/architecte" = str_wrap(
        "Profession libérale (avocat, huissier, comptable, notaire, architecte)",
        30
      ),
      "fonction publique" = str_wrap("Fonction publique", 30)
    )
  ) +
  scale_y_continuous(name = "Années de service ou d'activités professionnelles",
                     breaks = seq(0, 90, 10)) +
  theme_minimal(base_line_size = 1) +
  theme(
    text = element_text(family = "ubuntu"),
    axis.text = element_text(size = 13),
    axis.title.x = element_text(size = 13),
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.major.x = element_line(color = "grey80"),
    plot.caption = element_text(hjust = 0,
                                size = 11)
  )
```

## 7 et rapprochez vous d'un ministere

nomme par + croisement avec années de service et motifs

```{r}
df_legion %>%
  group_by(nomme_par_r, grade) %>%
  count() %>%
  group_by(nomme_par_r) %>%
  mutate(part = n / sum(n) * 100) %>%
  ungroup() %>%
  select(-n) %>%
  pivot_wider(
    names_from = grade,
    values_from = part,
    values_fill = list(part = 0)
  )
```

## 8 - Une décoration si particulière

```{r particule, include=FALSE}
# total
df_particule_tot <- df_legion %>% 
  mutate(particule = str_detect(nom_complet, " de | d'| des ")) %>% 
  group_by(particule) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(part = round(n / sum(n) * 100, 1),
         part = format(part, decimal.mark = ",")) %>% 
  filter(particule == TRUE) %>%
  pull(part)

# par grade
df_particule_grade <- df_legion %>% 
  mutate(particule = str_detect(nom_complet, " de | d'| des ")) %>% 
  group_by(grade, particule) %>% 
  count() %>% 
  group_by(grade) %>% 
  mutate(part = round(n / sum(n) * 100, 1), 
         part = format(part, decimal.mark = ",")) %>% 
  filter(particule == TRUE)
```

Avoir une particule dans votre nom peut servir. C'est très fortement le cas avant (http://coulmont.com/blog/2015/09/17/de-de-de/), cela l'est moins maintenant puisqu'un peu moins de `r df_particule_tot` % des nominations concernent des personnes portant des particules.

Cependant, c'est déjà une proportion raisonnable, il faut mettre toutes les chances de son côté ! Cela peut aussi beaucoup vous aider puisque la proportion augmente à mesure que l'on progresse dans l'ordre. Si elle est de `r filter(df_particule_grade, grade == "Chevalier") %>% pull(part)` % pour les chevaliers, elle augmente progressivement, à `r filter(df_particule_grade, grade == "Officier") %>% pull(part)` % pour les officiers et `r filter(df_particule_grade, grade == "Commandeur") %>% pull(part)` % pour les commandeurs. Accéder aux plus grandes dignités se fait encore davantage avec une particule puisque `r filter(df_particule_grade, grade == "Grand officier") %>% pull(part)` % des grands officiers et `r filter(df_particule_grade, grade == "Grand'croix") %>% pull(part)` % des grands'croix élevés en ont une !

## 9 - Vous vous appelez Jean, Pierre ou Michel ? Ou encore Françoise, Catherine ou Anne ? Bingo ! 

Certains prénoms concentrent les décorations. Sans surprise, il s'agit des prénoms beaucoup donnés dans les générations en âge de recevoir la Légion d'honneur. Pour la plupart, ce sont des prénoms dits "classiques".

```{r prenoms}
# Top des prenoms
df_prenoms_top <- df_legion %>% 
  filter(!is.na(sexe)) %>% 
  group_by(prenom, sexe) %>% 
  count(sort = TRUE) %>% 
  group_by(sexe) %>% 
  top_n(100, wt = n)

df_prenoms_top_m <- df_prenoms_top %>% 
  filter(sexe == "M") %>% 
  rowid_to_column() %>% 
  rename(prenom_m = prenom,
         n_m = n) %>% 
  ungroup() %>% 
  select(-sexe)

df_prenoms_top_f <- df_prenoms_top %>% 
  filter(sexe == "F") %>% 
  rowid_to_column() %>% 
  rename(prenom_f = prenom,
         n_f = n) %>% 
  ungroup() %>% 
  select(-sexe)

# Tableau
tab_prenoms <- df_prenoms_top_m %>% 
  inner_join(df_prenoms_top_f, by = "rowid")

reactable(tab_prenoms,
          columns = list(rowid = colDef(name = "Rang du prénom"),
                         prenom_m = colDef(name = "Homme"),
                         n_m = colDef(name = "Nombre de décorés"),
                         prenom_f = colDef(name = "Femme"),
                         n_f = colDef(name = "Nombre de décorés")),
          striped = TRUE,
          borderless = TRUE)
```

Certains prénoms, comme Claude par exemple, sont absents de la liste car on n'a pas sur les classer entre homme et femme.

## 10 - Etape bonus : devenir officier

## Conclusion 

Récap des points

## Tableau récapitulatif

Avec reactable tableau propre de récap pour recherche

## Encadré méthodo

+ chaîne de traitement (lien github)
+ approximations, l'analyse vaut ce qu'elle vaut
+ serait mieux si open data de la chancellerie

+ étape suivant = refaire l'analyse avec une base un peu mieux traitée (ne pas hésiter à faire des propositions -> pull request sur github)
